<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kinderkassa</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <noscript style="display:block;padding:12px;background:#ffeb3b;color:#000;font-family:system-ui,sans-serif">
    Bitte JavaScript aktivieren â€“ sonst funktioniert die Kinderkassa nicht.
  </noscript>

  <header class="topbar">
    <div class="brand">
      <div class="logo">ðŸ§¾</div>
      <div>
        <div class="title">KINDERKASSA</div>
        <div class="subtitle">Raspberry Pi Â· iPad Browser</div>
      </div>
    </div>

    <div class="top-right">
      <div class="clock" id="clock">--:--</div>
      <button class="btn" id="adminBtn" type="button">ADMIN (PIN)</button>
    </div>
  </header>

  <main class="layout" id="appRoot">
    <!-- Left: Cart -->
    <section class="panel cart">
      <div class="panel-head">
        <div class="panel-title" id="cartTitle">WARENKORB ðŸ›’</div>
        <div class="panel-actions">
          <button class="btn subtle" id="clearCartBtn" type="button">Warenkorb leeren</button>
        </div>
      </div>

      <div class="scanRow">
        <input
          id="scanInput"
          class="scanInput"
          inputmode="numeric"
          autocomplete="off"
          autocapitalize="off"
          spellcheck="false"
          placeholder="Code scannen/eintippen (EAN-8 / EAN-13) und Enterâ€¦"
        />
        <button class="btn" id="addByEanBtn" type="button">HinzufÃ¼gen</button>
      </div>

      <div class="tableWrap">
        <table class="cartTable">
          <thead>
            <tr>
              <th>Artikel</th>
              <th class="right">Preis</th>
              <th class="right">x</th>
              <th class="right">Summe</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="cartBody"></tbody>
        </table>
      </div>

      <div class="totals">
        <div class="totRow">
          <div>Positionen:</div>
          <div id="posCount">0</div>
        </div>
        <div class="totRow big">
          <div>Summe:</div>
          <div id="sumTotal">0,00 â‚¬</div>
        </div>
      </div>

      <div class="bottomActions">
        <button class="btn danger" id="stornoLastBtn" type="button">Letzten Artikel entfernen</button>
        <button class="btn" id="newReceiptBtn" type="button">Neuer Bon</button>
      </div>
    </section>

    <!-- Right: Payment -->
    <section class="panel pay">
      <div class="panel-head">
        <div class="panel-title" id="payTitle">ZAHLUNG ðŸ’¶</div>
      </div>

      <div class="paySummary">
        <div class="sumBox">
          <div class="label">SUMME</div>
          <div class="value" id="sumBoxValue">0,00 â‚¬</div>
        </div>
        <div class="sumBox">
          <div class="label">GEGEBEN</div>
          <div class="value" id="givenBoxValue">0,00 â‚¬</div>
        </div>
        <div class="sumBox">
          <div class="label">RÃœCKGELD</div>
          <div class="value" id="changeBoxValue">0,00 â‚¬</div>
        </div>
      </div>

      <div class="payButtonsTop">
        <button class="btn big" id="btnExact" type="button">PASSEND âœ…</button>
        <button class="btn big subtle" id="btnUndo" type="button">LETZTES ZURÃœCK â¬…ï¸Ž</button>
        <button class="btn big subtle" id="btnResetGiven" type="button">RESET â†º</button>
      </div>

      <div class="denomWrap">
        <div class="denomHead">
          <div class="denomTitle">MÃœNZEN</div>
          <div class="denomHint" id="denomHint">Tippe Geld an â€“ jeder Tap addiert.</div>
        </div>
        <div class="grid" id="coinsGrid"></div>

        <div class="denomHead">
          <div class="denomTitle">SCHEINE</div>
          <div class="denomHint" id="bigNotesHint"></div>
        </div>
        <div class="grid" id="notesGrid"></div>
      </div>

      <!-- WICHTIG: beide Buttons sind fix vorhanden -->
      <div class="printRow">
        <button class="btn primary" id="paidBtn" type="button">BEZAHLT âœ…</button>
        <button class="btn primary" id="printBtn" type="button">BON DRUCKEN ðŸ§¾</button>
        <div class="msg" id="msg"></div>
      </div>
    </section>
  </main>

  <!-- Admin Modal -->
  <div class="modalBackdrop hidden" id="adminBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Admin">
      <div class="modalHead">
        <div class="modalTitle">ADMIN</div>
        <button class="btn subtle" id="closeAdmin" type="button">SchlieÃŸen</button>
      </div>

      <!-- Scrollbarer Inhalt -->
      <div class="modalBody">
        <div id="adminLocked">
          <div class="field" style="padding:12px">
            <label>PIN</label>
            <input id="pinInput" type="password" inputmode="numeric" placeholder="PIN eingeben" />
          </div>
          <div style="padding:0 12px 12px">
            <button class="btn primary" id="pinLoginBtn" type="button">Entsperren</button>
          </div>
          <div class="hint">Standard-PIN: <b>1234</b> (kannst du im Code Ã¤ndern)</div>
        </div>

        <div id="adminUnlocked" class="hidden">

          <!-- SETTINGS -->
          <div class="adminGrid">
            <div class="field">
              <label>UI-Modus</label>
              <select id="uiModeSelect">
                <option value="standard">Standard</option>
                <option value="kid">Kindermodus</option>
              </select>
            </div>

            <div class="field">
              <label>Cent-Buttons</label>
              <select id="centModeSelect">
                <option value="all">Alle (1/2/5/10/20/50 Cent)</option>
                <option value="coarse">Grob (10/20/50 Cent)</option>
                <option value="none">Aus (keine Cent)</option>
              </select>
            </div>

            <div class="field">
              <label>GroÃŸe Scheine (100/200/500)</label>
              <select id="bigNotesSelect">
                <option value="off">Aus</option>
                <option value="on">Ein</option>
              </select>
            </div>

            <div class="field">
              <label>BestÃ¤tigung bei groÃŸen Scheinen</label>
              <select id="confirmBigNotesSelect">
                <option value="on">Ein</option>
                <option value="off">Aus</option>
              </select>
            </div>

            <div class="field">
              <label>Sound (Piep)</label>
              <select id="soundSelect">
                <option value="on">Ein</option>
                <option value="off">Aus</option>
              </select>
            </div>

            <div class="field">
              <label>Auto-Bon bei â€žBezahltâ€œ</label>
              <select id="autoPrintSelect">
                <option value="off">Aus</option>
                <option value="on">Ein</option>
              </select>
            </div>
          </div>

          <div class="adminActions">
            <button class="btn" id="saveSettingsBtn" type="button">Speichern</button>
            <button class="btn danger" id="logoutAdminBtn" type="button">Admin sperren</button>
          </div>

          <hr style="border:0;border-top:1px solid var(--line);margin:0">

          <!-- PRODUCT MANAGEMENT -->
          <div style="padding:12px">
            <div class="modalTitle" style="margin-bottom:8px">ARTIKEL VERWALTEN</div>

            <div class="adminGrid">
              <div class="field">
                <label>Code (EAN-8 oder EAN-13)</label>
                <input id="prodEanInput" inputmode="numeric" placeholder="7/8 oder 12/13 Stellen" />
              </div>

              <div class="field">
                <label>Artikelname</label>
                <input id="prodNameInput" placeholder="z. B. Apfel" />
              </div>

              <div class="field">
                <label>Preis (â‚¬) (z. B. 1,20)</label>
                <input id="prodPriceInput" inputmode="decimal" placeholder="z. B. 1,20" />
              </div>

              <div class="field">
                <label>Aktion</label>
                <div style="display:flex;gap:10px;flex-wrap:wrap">
                  <button class="btn" id="prodCalcCheckBtn" type="button">PrÃ¼fziffer berechnen</button>
                  <button class="btn primary" id="prodSaveBtn" type="button">Speichern</button>
                  <button class="btn danger" id="prodDeleteBtn" type="button">LÃ¶schen</button>
                </div>
              </div>
            </div>

            <div class="hint" id="prodHint" style="padding-top:0">
              Tipp: 7 Stellen â†’ EAN-8, 12 Stellen â†’ EAN-13 (PrÃ¼fziffer berechnen).
            </div>

            <div class="field" style="padding-top:6px">
              <label>Suche / Liste (klick zum Laden)</label>
              <input id="prodSearchInput" placeholder="Suche nach Name oder Codeâ€¦" />
            </div>

            <div style="max-height:240px;overflow:auto;border:1px solid var(--line);border-radius:12px;background:#0d1016;margin-top:8px">
              <table class="cartTable" style="margin:0">
                <thead>
                  <tr>
                    <th>Code</th>
                    <th>Artikel</th>
                    <th class="right">Preis</th>
                  </tr>
                </thead>
                <tbody id="prodListBody"></tbody>
              </table>
            </div>

            <hr style="border:0;border-top:1px solid var(--line);margin:12px 0">

            <!-- CSV IMPORT/EXPORT -->
            <div class="modalTitle" style="margin-bottom:8px">IMPORT / EXPORT</div>

            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn" id="exportCsvBtn" type="button">ðŸ“¤ Export CSV</button>

              <label class="btn" style="cursor:pointer">
                ðŸ“¥ Import CSV
                <input type="file" id="importCsvInput" accept=".csv" hidden>
              </label>
            </div>

            <div class="hint" id="csvHint" style="padding-top:8px">
              CSV-Format: <b>code;name;preis</b> (Code = EAN-8 oder EAN-13)
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- WICHTIG: defer verhindert "Element nicht gefunden" Bugs -->
  <script src="app.js" defer></script>

  <!-- Optional: Fokus-Hilfe (falls app.js das nicht schon macht)
       -> lÃ¤sst Scanner immer ins Feld schreiben, wenn nichts anderes aktiv ist -->
  <script>
    (function () {
      const scan = () => document.getElementById("scanInput");
      window.addEventListener("click", () => {
        const el = scan();
        if (!el) return;
        const active = document.activeElement;
        const isInput = active && (active.tagName === "INPUT" || active.tagName === "TEXTAREA");
        if (!isInput && !document.getElementById("adminBackdrop")?.classList.contains("hidden")) return;
        if (!isInput) el.focus({ preventScroll: true });
      });
    })();
  </script>
</body>
</html>

